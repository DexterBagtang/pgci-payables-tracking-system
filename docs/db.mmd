erDiagram
    users {
        int id PK
        varchar name
        varchar username UK
        varchar role
        varchar email UK
        varchar password
        datetime created_at
        datetime updated_at
    }

    vendors {
        int id PK
        varchar name
        varchar contact_person
        varchar email
        varchar phone
        text address
        varchar category
        varchar payment_terms
        boolean is_active
        varchar vendor_type
        int created_by FK
        datetime created_at
        datetime updated_at
    }

    projects {
        int id PK
        varchar project_title
        varchar cer_number
        numeric total_project_cost
        numeric total_contract_cost
        varchar project_status
        text description
        varchar project_type
        varchar smpo_number
        varchar philcom_category
        varchar team
        int created_by FK
        datetime created_at
        datetime updated_at
    }

    purchase_orders {
        int id PK
        varchar po_number UK
        int project_id FK
        int vendor_id FK
        numeric po_amount
        varchar po_status
        varchar payment_term
        date po_date
        date expected_delivery_date
        text description
        int created_by FK
        int finalized_by FK
        datetime finalized_at
        datetime created_at
        datetime updated_at
    }

    po_line_items {
        int id PK
        int po_id FK
        varchar item_description
        numeric quantity
        numeric unit_price
        numeric total_amount "GENERATED"
        varchar unit_of_measure
        datetime created_at
        datetime updated_at
    }

    invoices {
        int id PK
        int purchase_order_id FK
        varchar si_number
        date si_date
        numeric invoice_amount
        numeric tax_amount
        numeric discount_amount
        numeric net_amount
        varchar invoice_status
        varchar payment_type
        date due_date
        text notes
        varchar submitted_to
        int created_by FK
        datetime created_at
        datetime updated_at
    }

    check_requisitions {
        int id PK
        varchar requisition_number UK
        int invoice_id FK
        varchar requisition_status
        numeric php_amount
        date request_date
        varchar payee_name
        text purpose
        varchar po_number
        varchar cer_number
        varchar si_number
        varchar account_charge
        varchar service_line_dist
        text amount_in_words
        varchar requested_by
        varchar reviewed_by
        varchar approved_by
        int generated_by FK
        int processed_by FK
        datetime approved_at
        datetime processed_at
        datetime created_at
        datetime updated_at
    }

    remarks {
        int id PK
        varchar remarkable_type
        int remarkable_id
        text remark_text
        int created_by FK
        datetime created_at
        datetime updated_at
    }

    files {
        int id PK
        varchar fileable_type
        int fileable_id
        varchar file_name
        varchar file_path
        varchar file_type
        varchar file_category
        varchar file_purpose
        int file_size
        varchar disk
        text description
        boolean is_active
        int uploaded_by FK
        datetime created_at
        datetime updated_at
    }

    activity_logs {
        int id PK
        varchar loggable_type
        int loggable_id
        varchar action
        text changes
        int user_id FK
        varchar ip_address
        text notes
        datetime created_at
        datetime updated_at
    }

    audit_trails {
        int id PK
        varchar table_name
        int record_id
        varchar action
        text changes
        int user_id FK
        datetime performed_at
        varchar ip_address
        text user_agent
    }

%% Core Relationships
    users ||--o{ vendors : "created_by"
    users ||--o{ projects : "created_by"
    users ||--o{ purchase_orders : "created_by"
    users ||--o{ purchase_orders : "finalized_by"
    users ||--o{ invoices : "created_by"
    users ||--o{ check_requisitions : "generated_by"
    users ||--o{ check_requisitions : "processed_by"
    users ||--o{ remarks : "created_by"
    users ||--o{ files : "uploaded_by"
    users ||--o{ activity_logs : "user_id"
    users ||--o{ audit_trails : "user_id"

    vendors ||--o{ purchase_orders : "has"
    projects ||--o{ purchase_orders : "has"
    purchase_orders ||--|| po_line_items : "has"
    purchase_orders ||--o{ invoices : "has"
    invoices ||--o{ check_requisitions : "generates"

%% Polymorphic
    remarks }o--o{ vendors : "remarkable"
    remarks }o--o{ projects : "remarkable"
    remarks }o--o{ purchase_orders : "remarkable"
    remarks }o--o{ invoices : "remarkable"
    remarks }o--o{ check_requisitions : "remarkable"

    files }o--o{ users : "fileable"
    files }o--o{ vendors : "fileable"
    files }o--o{ projects : "fileable"
    files }o--o{ purchase_orders : "fileable"
    files }o--o{ invoices : "fileable"
    files }o--o{ check_requisitions : "fileable"

    activity_logs }o--o{ users : "loggable"
    activity_logs }o--o{ vendors : "loggable"
    activity_logs }o--o{ projects : "loggable"
    activity_logs }o--o{ purchase_orders : "loggable"
    activity_logs }o--o{ invoices : "loggable"
    activity_logs }o--o{ check_requisitions : "loggable"

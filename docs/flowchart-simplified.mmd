flowchart TD
    Start([Start: PGCI Payables System]) --> VendorSetup

    %% Vendor & Project Setup Phase
    VendorSetup[Setup Vendor]
    VendorSetup --> ProjectSetup[Create Project]
    ProjectSetup --> InvoiceChoice{Invoice Type?}

    %% Purchase Order Path
    InvoiceChoice -->|With PO| POCreation[Create Purchase Order]
    POCreation --> POOpen[PO Status: Open]
    POOpen --> WaitInvoice[Wait for Invoice]
    WaitInvoice --> CreatePOInvoice[Create PO Invoice]
    CreatePOInvoice --> InvoicePending

    %% Direct Invoice Path
    InvoiceChoice -->|Direct No PO| CreateDirectInvoice[Create Direct Invoice]
    CreateDirectInvoice --> InvoicePending

    %% Unified Invoice Processing
    InvoicePending[Invoice Status: Pending]
    InvoicePending --> TransferAccounting[Transfer to Accounting]
    TransferAccounting --> MarkReceived[Mark Files Received]
    MarkReceived --> ReviewInvoice[Review Invoice]

    ReviewInvoice --> ReviewCheck{Approve?}
    ReviewCheck -->|Reject| RejectInvoice[Status: Rejected]
    RejectInvoice --> InvoicePending
    ReviewCheck -->|Approve| ApproveInvoice[Status: Approved]

    %% Check Requisition
    ApproveInvoice --> CreateCheckReq[Create Check Requisition]
    CreateCheckReq --> CheckReqApproval{Approve?}
    CheckReqApproval -->|Reject| CreateCheckReq
    CheckReqApproval -->|Approve| CheckReqApproved[CR Approved]

    %% Disbursement
    CheckReqApproved --> CreateDisbursement[Create Disbursement]
    CreateDisbursement --> PrintCheck[Print Check]
    PrintCheck --> ReleaseCheck[Release to Vendor]

    %% Completion
    ReleaseCheck --> TypeCheck{Invoice Type?}
    TypeCheck -->|Direct| DirectComplete[Complete]
    TypeCheck -->|PO| CheckPOComplete{All PO Invoices Paid?}
    CheckPOComplete -->|No| WaitInvoice
    CheckPOComplete -->|Yes| ClosePO[Close PO]
    ClosePO --> Complete([End])
    DirectComplete --> Complete

    %% Styling
    classDef startEnd fill:#e3f2fd,stroke:#1976d2,stroke-width:3px
    classDef purchasingTask fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef accountingTask fill:#e8f5e9,stroke:#388e3c,stroke-width:2px
    classDef decision fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    classDef status fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    classDef directPath fill:#e1f5fe,stroke:#0277bd,stroke-width:2px

    class Start,Complete startEnd
    class VendorSetup,ProjectSetup,POCreation,CreatePOInvoice purchasingTask
    class CreateDirectInvoice directPath
    class TransferAccounting,MarkReceived,ReviewInvoice,CreateCheckReq,CreateDisbursement,PrintCheck,ReleaseCheck accountingTask
    class InvoiceChoice,ReviewCheck,CheckReqApproval,TypeCheck,CheckPOComplete decision
    class POOpen,InvoicePending,RejectInvoice,ApproveInvoice,CheckReqApproved,ClosePO status

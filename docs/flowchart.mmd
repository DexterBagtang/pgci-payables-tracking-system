flowchart TD
    Start([Start: PGCI Payables System]) --> VendorSetup

    %% ========================================
    %% SETUP PHASE
    %% ========================================
    subgraph Setup["üîß Setup Phase"]
        VendorSetup[Setup Vendors & Projects]
    end

    VendorSetup --> InvoiceDecision{Invoice Type?}

    %% ========================================
    %% PURCHASE ORDER PATH
    %% ========================================
    subgraph POPath["üìã Purchase Order Path"]
        direction TB
        POCreation[Create Purchase Order]
        PODetails[Enter PO Details:<br/>‚Ä¢ Vendor<br/>‚Ä¢ Project<br/>‚Ä¢ Amount<br/>‚Ä¢ Terms]
        POOpen[PO Status: Open]
        WaitInvoice[‚è≥ Wait for Vendor Invoice]
        CreatePOInvoice[Create PO Invoice]
        POInvoiceDetails[Link to PO &<br/>Enter Invoice Details]
        
        POCreation --> PODetails
        PODetails --> POOpen
        POOpen --> WaitInvoice
        WaitInvoice --> CreatePOInvoice
        CreatePOInvoice --> POInvoiceDetails
    end

    %% ========================================
    %% DIRECT INVOICE PATH
    %% ========================================
    subgraph DirectPath["üíº Direct Invoice Path"]
        direction TB
        CreateDirectInvoice[Create Direct Invoice]
        DirectInvoiceDetails[Enter Invoice Details:<br/>‚Ä¢ Select Vendor<br/>‚Ä¢ Project<br/>‚Ä¢ Amount<br/>‚Ä¢ Description]
        
        CreateDirectInvoice --> DirectInvoiceDetails
    end

    InvoiceDecision -->|With PO| POCreation
    InvoiceDecision -->|Direct/No PO| CreateDirectInvoice

    %% Converge both paths
    POInvoiceDetails --> InvoicePending
    DirectInvoiceDetails --> InvoicePending

    %% ========================================
    %% ACCOUNTING REVIEW PHASE
    %% ========================================
    subgraph AcctReview["üí∞ Accounting Review Phase"]
        direction TB
        InvoicePending[Invoice Status: Pending]
        AccountingReceive[Transfer to Accounting]
        MarkReceived[Mark Supporting Files Received<br/>Status: Received]
        ReviewInvoice[Review Invoice & Documents]
        ReviewDecision{Documents<br/>Complete &<br/>Accurate?}
        ApproveInvoice[‚úÖ Status: Approved<br/>Record Reviewer & Date]
        RejectInvoice[‚ùå Status: Rejected<br/>Add Rejection Remarks]
        
        InvoicePending --> AccountingReceive
        AccountingReceive --> MarkReceived
        MarkReceived --> ReviewInvoice
        ReviewInvoice --> ReviewDecision
        ReviewDecision -->|Yes| ApproveInvoice
        ReviewDecision -->|No| RejectInvoice
    end

    %% Rejection Loop
    RejectInvoice --> NotifyPurchasing[üìß Notify Purchasing Department]
    NotifyPurchasing -->|PO Invoice| POInvoiceDetails
    NotifyPurchasing -->|Direct Invoice| DirectInvoiceDetails

    %% ========================================
    %% CHECK REQUISITION PHASE
    %% ========================================
    subgraph CheckReqPhase["üìù Check Requisition Phase"]
        direction TB
        CreateCheckReq[Create Check Requisition]
        SelectInvoices[Select Approved Invoices<br/>for Payment Batch]
        CheckReqDetails[Enter CR Details:<br/>‚Ä¢ Payee<br/>‚Ä¢ Payment Date<br/>‚Ä¢ Total Amount]
        SubmitCR[Submit for Management Approval]
        ReviewCR[üëî Management Review]
        CRDecision{Approve<br/>Payment?}
        RejectCR[‚ùå Status: Rejected<br/>Return to Accounting]
        ApproveCR[‚úÖ Status: Approved<br/>Invoices: Pending Disbursement]
        
        CreateCheckReq --> SelectInvoices
        SelectInvoices --> CheckReqDetails
        CheckReqDetails --> SubmitCR
        SubmitCR --> ReviewCR
        ReviewCR --> CRDecision
        CRDecision -->|No| RejectCR
        CRDecision -->|Yes| ApproveCR
    end

    ApproveInvoice --> CreateCheckReq
    RejectCR --> CheckReqDetails

    %% ========================================
    %% DISBURSEMENT PHASE
    %% ========================================
    subgraph DisbursementPhase["üíµ Disbursement Phase"]
        direction TB
        CreateDisbursement[Create Disbursement]
        DisbursementDetails[Enter Details:<br/>‚Ä¢ Check Number<br/>‚Ä¢ Bank Account<br/>‚Ä¢ Date Issued]
        PrintCheck[üñ®Ô∏è Print Check]
        ReleaseCheck[Release Check to Vendor<br/>Invoice Status: Paid ‚úì]
        
        CreateDisbursement --> DisbursementDetails
        DisbursementDetails --> PrintCheck
        PrintCheck --> ReleaseCheck
    end

    ApproveCR --> CreateDisbursement

    %% ========================================
    %% COMPLETION PHASE
    %% ========================================
    ReleaseCheck --> InvoiceTypeCheck{Invoice Type?}
    InvoiceTypeCheck -->|Direct Invoice| DirectComplete[‚úì Direct Invoice Complete]
    InvoiceTypeCheck -->|PO Invoice| CheckPOStatus{All PO<br/>Invoices<br/>Paid?}
    
    CheckPOStatus -->|No| WaitMoreInvoices[‚è≥ Wait for More Invoices]
    WaitMoreInvoices --> WaitInvoice
    CheckPOStatus -->|Yes| ClosePO[üîí Close Purchase Order<br/>Status: Closed]

    ClosePO --> Complete([‚úì Process Complete])
    DirectComplete --> Complete

    %% ========================================
    %% STYLING
    %% ========================================
    classDef startEnd fill:#1a237e,stroke:#0d47a1,stroke-width:4px,color:#fff
    classDef purchasingTask fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef directTask fill:#e1f5fe,stroke:#0277bd,stroke-width:2px
    classDef accountingTask fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px
    classDef managementTask fill:#fff9c4,stroke:#f57f17,stroke-width:2px
    classDef disbursementTask fill:#ffe0b2,stroke:#e65100,stroke-width:2px
    classDef decision fill:#fff3e0,stroke:#f57c00,stroke-width:3px
    classDef statusGood fill:#c8e6c9,stroke:#388e3c,stroke-width:2px
    classDef statusBad fill:#ffcdd2,stroke:#c62828,stroke-width:2px
    classDef statusWait fill:#fff9c4,stroke:#fbc02d,stroke-width:2px
    classDef notification fill:#e3f2fd,stroke:#1976d2,stroke-width:2px

    class Start,Complete startEnd
    class VendorSetup,POCreation,PODetails,POOpen,CreatePOInvoice,POInvoiceDetails purchasingTask
    class CreateDirectInvoice,DirectInvoiceDetails directTask
    class AccountingReceive,MarkReceived,ReviewInvoice,CreateCheckReq,SelectInvoices,CheckReqDetails accountingTask
    class ReviewCR managementTask
    class CreateDisbursement,DisbursementDetails,PrintCheck,ReleaseCheck disbursementTask
    class InvoiceDecision,ReviewDecision,CRDecision,InvoiceTypeCheck,CheckPOStatus decision
    class ApproveInvoice,ApproveCR,DirectComplete,ClosePO statusGood
    class RejectInvoice,RejectCR statusBad
    class POOpen,InvoicePending,WaitInvoice,WaitMoreInvoices,SubmitCR statusWait
    class NotifyPurchasing notification
